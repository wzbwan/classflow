# 课堂数据管理与作业收发 Web 应用：轻量版设计草案

> 目标：为中小规模课程（30–300 人）提供极简、低成本、易维护的课堂数据管理与作业收发解决方案，覆盖教师、助教与学生的核心流程。

---

## 1. 核心价值 & 使用场景

- **教师/助教**：批量导入名册，布置作业，统一收取与批改，快速统计成绩，导出期末总评。
- **学生**：一键提交作业（支持多文件/链接），查看反馈与成绩，补交与申诉流程清晰。
- **教务/课程协调**：对全班出勤与成绩的宏观视图；合规留痕与数据备份。

---

## 2. 角色与权限

- **管理员(Admin)**：系统设置、院系/课程创建、用户批量导入、备份/恢复。
- **教师(Teacher)**：课程配置、作业创建、评分规则、批改、统计导出。
- **助教(TA)**：与教师几乎相同，但仅限被分配课程；可批改、可导出。
- **学生(Student)**：查看日程与作业、提交/补交、查看反馈、申诉。

权限粒度（示例）

- 课程层面：`manage_course`、`create_assignment`、`grade_submission`、`view_all_grades`、`export_gradebook`、`appeal_review`、`submit_assignment`。

---

## 3. 功能清单（MVP → v1.0）

### 3.1 MVP（首周可用）

1. 账号系统：学号+密码。

2. 课程与班级：创建课程、学期设置、班级分组。

3. 名册导入/导出：CSV 模板导入，学号为主键；导出为 CSV/XLSX。

4. 作业：标题、描述、截止时间、允许补交/迟交扣分；支持文件上传。

5. 提交：学生多次提交取最新。

6. 评分：手动打分、简单 rubric（维度×权重×分值）；文本评语。

7. 成绩簿：总分计算（加权、掉最低若干次、迟交扣分规则）。

8. 基础统计：提交率、迟交率、分布图（箱线/柱状，后续加）。

### 3.2 v1.0（进阶）

- 批改加速：批量下载/批量评分、快捷键、批注模板。
- 抄袭检测占位接口（对接 Turnitin/本地相似度算法，可后置）。
- 申诉与复查工作流：学生发起 → 教师处理 → 记录。
- 出勤与课堂活动（点名/测验）轻负载模块。
- API Token 与 Webhook（成绩变更/作业创建事件）。

---

## 4. 信息架构（IA）与页面

- 登录/注册/忘记密码
- 仪表盘（按角色显示）：
  - 教师/TA：待批改、即将到期作业、异常提醒（未发布/集中到期）。
  - 学生：下一个截止、已提交/未提交、反馈待查看。
- 课程主页：公告、作业列表、成绩簿、成员名单、设置。
- 作业详情：描述、附件、提交入口、评分与反馈、评分标准。
- 成绩簿：列（学生）× 行（作业），可内联编辑、筛选、导出。
- 设置：评分策略、迟交规则、可见性、数据导出与备份。

---

## 5. 数据模型（简化 ERD）

```
User(id, name, email, role, password_hash, created_at)
Course(id, name, term, code, owner_id)
Enrollment(id, course_id, user_id, role_in_course)
Assignment(id, course_id, title, description, due_at, allow_late, late_policy, max_points, rubric_json)
Submission(id, assignment_id, student_id, submitted_at, status, files_json, external_link, version)
Grade(id, submission_id, grader_id, score, rubric_scores_json, feedback_text, feedback_audio_url, graded_at)
Appeal(id, grade_id, student_id, reason, status, resolution_note, created_at)
Attendance(id, course_id, student_id, date, status)
Notification(id, user_id, type, payload_json, read)
```

索引建议：

- `Enrollment(course_id, user_id)` 唯一索引。
- `Submission(assignment_id, student_id, version)` 复合索引。
- 读多写少表（Assignment/Grade）加 `updated_at` 索引以便增量导出。

---

## 6. 评分与总评计算（规则示例）

- 课程权重：作业 60%，测验 20%，期末项目 20%。
- 迟交：每 24h 扣 10%，最多扣至 50%。
- 丢最低：家庭作业丢最低 1 次。
- 计算公式（伪代码）：

```pseudo
for each category in categories:
  drop lowest n assignments
  category_score = sum(weighted_scores) / sum(max_points)
final_score = Σ(category_weight × category_score)
```

---

## 7. API 设计（REST，后续可加 GraphQL）

**认证**

- `POST /api/auth/login {email, password}` → `{token}`
- `POST /api/auth/refresh {token}`

**课程**

- `GET /api/courses`、`POST /api/courses`、`GET /api/courses/:id`
- `POST /api/courses/:id/enrollments:import`（CSV 上传）

**作业**

- `POST /api/courses/:id/assignments`
- `GET /api/assignments/:id`
- `POST /api/assignments/:id/submissions`（表单+文件）

**评分**

- `POST /api/submissions/:id/grade`
- `GET /api/courses/:id/gradebook?format=csv`

**通知/Webhook**

- `POST /api/hooks`（注册事件：`assignment.created`, `grade.updated`）

请求/响应示例：

```http
POST /api/assignments/42/submissions
Content-Type: multipart/form-data
files[]: report.pdf
external_link: https://github.com/user/repo
```

```json
{
  "id": 1001,
  "assignment_id": 42,
  "student_id": 3008,
  "submitted_at": "2025-03-01T10:00:00Z",
  "version": 3,
  "status": "submitted"
}
```

---

## 8. 技术栈（“轻量优先”）

- **前端**：React + Vite（或 Next.js App Router），Tailwind；PWA 支持；表格使用 TanStack Table；表单 React Hook Form。
- **后端**：Node.js (Express/Fastify)；**SQLite**（单机/嵌入式，便于备份与迁移）；Prisma ORM。
- **存储**：本地磁盘（开发/小课）；S3 兼容（MinIO/阿里云/腾讯云）用于作业文件。
- **认证**：JWT（短期）+ 刷新令牌。
- **部署**：Docker 单容器；Nginx 反向代理。



为何选 SQLite？

- 单机即用，维护成本极低；后续可切换 Postgres，仅调 Prisma 连接与少量索引。

---

## 9. 非功能性要求

- **性能**：并发 300 学生提交峰值，单作业文件平均 <20MB；上传限速与并发阈值。
- **安全**：角色鉴权、文件类型与大小白名单、病毒扫描（ClamAV 可选）、CSRF/XSS 防护、速率限制。
- **隐私合规**：最小收集原则；可匿名化导出；数据保留策略（学期+1 年）。
- **可用性**：移动端优先；离线草稿（PWA）；可访问性（WCAG AA）。

---

## 10. 原型草图（文字版）

**作业详情页**

- Header：标题、截止时间、迟交策略、发布状态开关
- Tabs：说明｜提交｜评分｜统计
- 提交区（学生视角）：文件拖拽框 + 外链输入 + 提交按钮；历史版本列表
- 评分区（教师/TA）：左侧文件预览，右侧 rubric 面板与得分输入，快捷评语
- 统计：提交率卡片、分数分布图、迟交热力图（按日期）

**成绩簿页**

- 顶部筛选：班级、作业、分组、状态（缺交/迟交）
- 表格：可内联编辑单元格；批量导入/导出；异常高亮

---

## 11. 开发里程碑（示例 3 周）

- **第 1 周**：数据模型搭建（Prisma）、认证、课程/名册、作业创建与列表、文件上传打通。
- **第 2 周**：提交/版本、评分与反馈、成绩簿基础、CSV 导出、通知。
- **第 3 周**：迟交策略、统计页、批量评分、PWA、备份任务、Docker 部署说明。

---

## 12. 测试清单

- 单元：规则计算、权限中间件、文件上传限制。
- 集成：提交→评分→导出流水线；名册导入回滚。
- 端到端：学生提交流程、教师批改 10 份样本、成绩可见性切换。

---

## 13. 部署与备份策略

- `.env`：数据库路径、S3 凭证、JWT 秘钥、最大上传大小。

- 备份脚本（每日 2:00）：

  - `sqlite3 db.sqlite ".backup backup/db-$(date).sqlite"`
  -

---

## 15. 最小可运行样例（代码骨架计划）

> 如需，我将生成以下目录 + 核心文件模板。

```
app/
  web/ (React+Vite)
  server/ (Fastify+Prisma+SQLite)
  docker-compose.yml
  README.md
```

- 端点：`/auth/login`、`/courses`、`/assignments`、`/submissions`、`/gradebook`（CSV）
- 组件：AssignmentList、SubmissionUploader、RubricPanel、GradebookTable


